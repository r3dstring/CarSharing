<%- include('layout', { user, body: `
  <section>
    <div class="card">
      <h2>ðŸš— ${ride.start_location} â†’ ${ride.end_location}</h2>

      <div class="detail-box">
        <p><strong>Driver:</strong> ${ride.driver_name}</p>
        <p><strong>Contact:</strong> ${ride.driver_email}</p>
        <p><strong>Departure:</strong> ${ride.departure_time}</p>
        <p><strong>Price per seat:</strong> â‚¹${ride.price_per_seat}</p>
        <p><strong>Available seats:</strong> ${ride.available_seats}</p>
        ${ride.notes ? `<p><strong>Notes:</strong> ${ride.notes}</p>` : ''}
      </div>
    </div>

    <h3>Passengers</h3>
    ${passengers.length === 0 ? `<p>No passengers yet.</p>` : `
      <div class="card">
        <ul>
        ${passengers.map(p => `
          <li>${p.passenger_name} (${p.passenger_email}) â€” ${p.seats_booked} seats</li>
        `).join('')}
        </ul>
      </div>
    `}

    ${ride.driver_id === user.id ? `
      <p><strong>You are the driver of this ride.</strong></p>
    ` : `
      ${
        myBooking
        ? `
          <p>You booked ${myBooking.seats_booked} seats.</p>
          <form method="POST" action="/bookings/${myBooking.id}/cancel?_method=DELETE">
            <button class="btn btn-secondary">Cancel Booking</button>
          </form>
        `
        : (
            ride.available_seats > 0
            ? `
            <div class="card">
              <h3>Book Your Seats</h3>
              <form method="POST" action="/rides/${ride.id}/book">
                <label>Select seats</label>
                <input type="number" name="seats_booked" min="1" max="${ride.available_seats}" required />

                <p><strong>Total:</strong> â‚¹<span id="totalPrice">0</span></p>

                <button type="submit">Confirm Booking</button>
              </form>
            </div>
            <script>
              const price = ${ride.price_per_seat};
              const input = document.querySelector('input[name="seats_booked"]');
              const output = document.getElementById('totalPrice');
              input.addEventListener('input', () => {
                 output.innerText = price * input.value;
              });
            </script>
            `
            : `<p>No seats available.</p>`
        )
      }
    `}
  </section>
` }) %>
